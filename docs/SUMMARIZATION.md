# Суммаризация документов

## Описание

Функция суммаризации позволяет автоматически создавать краткое содержание загруженных документов с использованием LLM. Это помогает быстро понять основное содержание документа без необходимости его полного прочтения.

## Использование через веб-интерфейс

### Шаг 1: Загрузите документ
Загрузите документ через кнопку "Загрузить файл" в веб-интерфейсе.

### Шаг 2: Выберите документ
Кликните на документ в списке слева для его выбора. Выбранный документ будет подсвечен.

### Шаг 3: Запросите суммаризацию
В поле ввода введите команду:
```
summary
```
или по-русски:
```
суммаризация
```

### Шаг 4: Получите результат
Система сгенерирует краткое содержание документа со следующей информацией:
- Название документа
- Количество фрагментов
- Структурированное краткое содержание с заголовками и списками

## Использование через API

### Запрос

**Endpoint:** `POST /api/summarize`

**Тело запроса:**
```json
{
  "document_id": 1
}
```

### Ответ

```json
{
  "summary": "Краткое содержание документа с основными темами и выводами...",
  "document_id": 1,
  "filename": "document.pdf",
  "chunk_count": 42
}
```

**Поля ответа:**
- `summary` - текст суммаризации в формате Markdown
- `document_id` - ID документа
- `filename` - имя файла документа
- `chunk_count` - количество фрагментов в документе

### Пример с curl

```bash
curl -X POST "http://localhost:8000/api/summarize" \
  -H "Content-Type: application/json" \
  -d '{"document_id": 1}'
```

## Использование через SDK

### Базовый пример

```python
from RAG import RAGManager

async def main():
    rag = RAGManager()
    await rag.initialize()
    
    # Суммаризация документа
    result = await rag.summarize_document(document_id=1)
    
    print(f"Документ: {result['filename']}")
    print(f"Фрагментов: {result['chunk_count']}")
    print(f"\n{result['summary']}")
    
    await rag.close()
```

### Суммаризация всех документов

```python
from RAG import RAGManager

async def summarize_all_documents():
    rag = RAGManager()
    await rag.initialize()
    
    documents = await rag.get_documents()
    
    for doc in documents:
        print(f"\n{'='*60}")
        print(f"Обработка: {doc['filename']}")
        print(f"{'='*60}")
        
        result = await rag.summarize_document(doc['id'])
        print(result['summary'])
    
    await rag.close()
```

### Сохранение суммаризации в файл

```python
from RAG import RAGManager
import os

async def save_summary_to_file(document_id: int, output_dir: str = "summaries"):
    rag = RAGManager()
    await rag.initialize()
    
    result = await rag.summarize_document(document_id)
    
    # Создаем директорию если её нет
    os.makedirs(output_dir, exist_ok=True)
    
    # Формируем имя файла
    filename = f"{result['filename']}_summary.md"
    filepath = os.path.join(output_dir, filename)
    
    # Сохраняем суммаризацию
    with open(filepath, 'w', encoding='utf-8') as f:
        f.write(f"# Краткое содержание: {result['filename']}\n\n")
        f.write(f"**Фрагментов:** {result['chunk_count']}\n\n")
        f.write(f"---\n\n")
        f.write(result['summary'])
    
    print(f"Суммаризация сохранена в: {filepath}")
    
    await rag.close()
```

## Технические детали

### Процесс суммаризации

1. **Получение документа**: система получает информацию о документе из базы данных
2. **Извлечение чанков**: все текстовые фрагменты документа извлекаются и сортируются по порядку
3. **Объединение текста**: фрагменты объединяются в единый текст
4. **Ограничение размера**: если текст превышает 15000 символов, он обрезается для оптимальной работы LLM
5. **Генерация суммаризации**: текст отправляется в LLM с специальным промптом для создания структурированного краткого содержания
6. **Форматирование**: результат форматируется с использованием Markdown

### Промпт для суммаризации

Система использует специальный промпт, который требует от LLM:
- Общее описание документа в 2-3 предложениях
- Выделение основных тем и разделов
- Использование маркированных списков
- Выделение важных терминов жирным шрифтом
- Структурирование с помощью заголовков
- Сохранение последовательности изложения
- Указание ключевых выводов

### Ограничения

- **Размер текста**: для очень больших документов (>15000 символов) суммаризация выполняется по первым 15000 символам
- **Требуется LLM**: для работы суммаризации необходимо настроенное подключение к LLM провайдеру
- **Время выполнения**: генерация суммаризации может занять от нескольких секунд до минуты в зависимости от размера документа и скорости работы LLM

### Поддерживаемые форматы

Суммаризация работает со всеми форматами файлов, поддерживаемыми RAG:
- PDF (`.pdf`)
- Microsoft Word (`.docx`, `.doc`)
- Microsoft Excel (`.xlsx`, `.xls`)
- Markdown (`.md`, `.markdown`)
- HTML (`.html`, `.htm`)
- Текстовые файлы (`.txt`, `.csv`, `.json`, `.xml`, `.log`)

## Практические применения

### 1. Быстрое знакомство с документом
Получите краткое содержание перед детальным изучением документа.

### 2. Составление каталога документов
Создайте базу кратких содержаний для библиотеки документов.

### 3. Сравнение версий
Сравните суммаризации разных версий документа для выявления изменений.

### 4. Создание аннотаций
Используйте суммаризацию как основу для создания аннотаций к документам.

### 5. Поиск нужного документа
Просматривайте краткие содержания для быстрого поиска нужного документа в большой коллекции.

## Советы по использованию

1. **Для лучших результатов** используйте документы с четкой структурой и логичным изложением
2. **Проверяйте результаты** - суммаризация может упустить некоторые детали
3. **Используйте разные LLM** - разные модели могут давать разные по стилю суммаризации
4. **Комбинируйте с вопросами** - после суммаризации задавайте уточняющие вопросы для получения деталей

## Устранение неполадок

### Ошибка "Документ не найден"
- Проверьте, что документ существует в системе
- Убедитесь, что используется правильный `document_id`

### Пустая или короткая суммаризация
- Проверьте, что документ содержит достаточно текста
- Убедитесь, что LLM правильно настроен и отвечает

### Суммаризация не соответствует документу
- Попробуйте другую LLM модель
- Проверьте, что документ был корректно загружен и обработан

### Долгое время выполнения
- Это нормально для больших документов
- Попробуйте использовать более быструю LLM модель
- Проверьте соединение с LLM провайдером

## См. также

- [Использование](USAGE.md) - общее руководство по использованию RAG
- [API Документация](../README.md#api-endpoints) - полное описание API
- [Настройка LLM](ENV_SETUP.md) - конфигурация LLM провайдеров

